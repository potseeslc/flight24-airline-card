type: custom:html-template-card
card_mod:
  style: |
    ha-card {
      min-height: 100vh;
      background: #020617;
      border-radius: 0;
      box-shadow: none;
      padding: 0;
      margin: 0;
    }
ignore_line_breaks: true
entities:
  - sensor.flightradar24_current_in_area
  - sensor.flightradar24_most_tracked
content: |
  {% set fallback_icon = '/local/assets/fallback-airline/icon.png' %}
  {% set private_icon  = '/local/assets/private-plane/private-plane.png' %}

  {% set local = state_attr('sensor.flightradar24_current_in_area', 'flights') or [] %}
  {% set local_filtered = local | selectattr('altitude', '>', 10000) | list %}

  {% if local_filtered | length > 0 %}
    {% set mode = 'local' %}
    {% set f = local_filtered | sort(attribute='distance') | first %}
  {% else %}
    {% set mode = 'most' %}
    {% set most = state_attr('sensor.flightradar24_most_tracked', 'flights') or [] %}
    {% set f = most[0] if most | length > 0 else None %}
  {% endif %}

  <div style="
    min-height:100vh;
    width:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
    color:#e5e7eb;
  ">

  {% if not f %}
    <div style="font-size:clamp(18px,3vw,28px);opacity:0.85;">
      No flights available ✈️
    </div>
  {% else %}

    {% set fn        = (f.flight_number or '') | string %}
    {% set cs        = (f.callsign or '') | string %}
    {% set airline   = (f.airline_short or 'Unknown') | string %}
    {% set airline_l = airline | lower %}
    {% set origin    = f.airport_origin_city or 'Unknown' %}
    {% set dest      = f.airport_destination_city or 'Unknown' %}
    {% set alt       = f.altitude or 0 %}
    {% set gs        = f.ground_speed or 0 %}

    {% if mode == 'local' %}
      {% set dist     = (f.distance | float | round(1)) %}
      {% set header   = 'Closest flight • ' ~ dist ~ ' km from home' %}
      {% set sublabel = 'Nearby flight' %}
    {% else %}
      {% set header   = 'Most tracked flight on Flightradar24' %}
      {% set sublabel = 'Most tracked flight' %}
    {% endif %}

    {% set logo_url = fallback_icon %}
    {% if 'unknown' in airline_l %}
      {% set airline_label = sublabel %}
    {% else %}
      {% set airline_label = airline %}
    {% endif %}

    {% if fn.startswith('N') or cs.startswith('N') %}
      {% set logo_url = private_icon %}
      {% set airline_label = 'Private aircraft' %}
    {% endif %}

    <div style="
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      width:100%;
      max-width:1100px;
      padding:24px;
    ">

      <div style="
        width:100%;
        display:grid;
        grid-template-columns:1fr auto;
        gap:18px;
        align-items:center;
      ">

        <div style="display:flex;flex-direction:column;gap:8px;">
          <div style="
            font-size:clamp(10px,1.4vw,14px);
            opacity:0.7;
            letter-spacing:0.15em;
            text-transform:uppercase;
          ">
            {{ header }}
          </div>

          <div style="font-size:clamp(28px,5vw,56px);font-weight:600;">
            {{ fn if fn | length > 0 else cs }}
          </div>

          <div style="font-size:clamp(16px,2.5vw,28px);opacity:0.8;">
            {{ cs }}
          </div>

          <div style="font-size:clamp(18px,3vw,32px);opacity:0.9;margin-top:2px;">
            {{ origin }} → {{ dest }}
          </div>

          <div style="
            margin-top:10px;
            font-size:clamp(12px,1.6vw,16px);
            display:flex;
            gap:24px;
          ">
            <div>
              <div style="
                font-size:clamp(9px,1.2vw,12px);
                opacity:0.6;
                text-transform:uppercase;
                letter-spacing:0.15em;
              ">
                Altitude
              </div>
              <div style="font-size:clamp(20px,3vw,34px);font-weight:600;">
                {{ alt | int }} ft
              </div>
            </div>
            <div>
              <div style="
                font-size:clamp(9px,1.2vw,12px);
                opacity:0.6;
                text-transform:uppercase;
                letter-spacing:0.15em;
              ">
                Ground Speed
              </div>
              <div style="font-size:clamp(20px,3vw,34px);font-weight:600;">
                {{ gs | int }} kts
              </div>
            </div>
          </div>
        </div>

        <div style="text-align:right;">
          <img
            src="{{ logo_url }}"
            style="width:clamp(80px,14vw,150px);height:auto;filter:drop-shadow(0 0 2px #0008);"
          />
          <div style="
            font-size:clamp(10px,1.5vw,16px);
            opacity:0.7;
            text-transform:uppercase;
            margin-top:4px;
          ">
            {{ airline_label }}
          </div>
        </div>

      </div>
    </div>

  {% endif %}
  </div>
